# JWT Authentication Microservice

[![GoDoc Badge]][GoDoc] [![GoReportCard Badge]][GoReportCard]

[GoDoc]: https://godoc.org/github.com/mjah/jwt-auth
[GoDoc Badge]: https://godoc.org/github.com/mjah/jwt-auth?status.svg
[GoReportCard]: https://goreportcard.com/report/github.com/mjah/jwt-auth
[GoReportCard Badge]: https://goreportcard.com/badge/github.com/mjah/jwt-auth

## Features

## Prerequisite

### Generate an RSA keypair with a 2048 bit private key

Private key:

```sh
openssl genpkey -algorithm RSA -out private_key.pem -pkeyopt rsa_keygen_bits:2048
```

Public key:

```sh
openssl rsa -pubout -in private_key.pem -out public_key.pem
```

### Configuration

See the [config.example.yml](https://github.com/mjah/jwt-auth/blob/master/config.example.yml) file for an example of the configuration.

Environment variables are also supported. This will be the configuration name in all capital letters, 'JA\_' prefixed, and '.' replaced with '\_'. E.g. **account.password_cost** becomes **JA_ACCOUNT_PASSWORD_COST**.

Configuration Name | Type | Default | Description
---|---|---|---
environment | string | development | ...
log_level | string | debug | ...
log_email | bool | true | ...
account.password_cost | int | 11 | ...
account.confirm_token_expires | time.Duration | 24h00m | ...
account.confirm_token_endpoint | string | | ...
account.reset_password_token_expires | time.Duration | 1h00m | ...
account.reset_password_token_endpoint | string | | ...
roles.define | []string | [admin member guest] | ...
roles.default | string | guest | ...
serve.host | string | localhost | ...
serve.port | int | 9096 | ...
token.public_key_path | string || ...
token.private_key_path | string || ...
token.issuer | string | jwt-auth | ...
token.access_token_expires | time.Duration | 5m | ...
token.refresh_token_expires | time.Duration | 8h00m | ...
token.refresh_token_expires_extended | time.Duration | 8760h00m | ...
postgres.host | string | localhost | ...
postgres.port | int | 5432 | ...
postgres.username | string | postgres | ...
postgres.password | string | psotgres | ...
postgres.database | string | jwt-auth | ...
amqp.host | string | localhost | ...
amqp.port | int | 5672 | ...
amqp.username | string | guest | ...
amqp.password | string | guest | ...
email.smtp_host | string || ...
email.smtp_port | int || ...
email.smtp_username | string || ...
email.smtp_password | string || ...
email.from_address | string || ...
email.from_name | string || ...
email.test_receipient | string || ...

## API Routes

### Public Routes

Path | Method | JSON Data | Error Codes | Description
---|---|---|---|---
/v1/auth/signup | POST | email (string, required)<br>username (string, required)<br>password (string, required)<br>first_name (string, required)<br>last_name (string, required) || ...
/v1/auth/signin | POST | email (string, required)<br>password (string, required)<br>remember_me (bool, required) || ...
/v1/auth/confirm | POST | email (string, required)<br>confirm_token (string, required) || ...
/v1/auth/resetpassword | POST | email (string, required)<br>reset_password_token (string, required)<br>password (string, required) || ...
/v1/auth/send_confirm_email | POST | email (string, required) || ...
/v1/auth/send_resetpassword_email | POST | email (string, required) || ...

### Private Routes

Requires refresh token in authorization bearer.

Path | Method | JSON Data | Error Codes | Description
---|---|---|---|---
/v1/auth/signout | GET ||| ...
/v1/auth/signout_all | GET ||| ...
/v1/auth/refreshtoken | GET ||| ...
/v1/auth/update | PATCH | email (string, optional)<br>username (string, optional)<br>password (string, optional)<br>first_name (string, optional)<br>last_name (string, optional) || ...
/v1/auth/delete | DELETE ||| ...

### Error Codes

Error codes can be seen in [errors/codes.go](https://github.com/mjah/jwt-auth/blob/master/errors/codes.go)

## Example Client

To see an implementation of the jwt-auth API, please see the following [example client](https://github.com/mjah/jwt-auth-client-example).

## Contributing

Any feedback and pull requests are welcome and highly appreciated. Please open an issue first if you intend to send in a larger pull request or want to add additional features.
